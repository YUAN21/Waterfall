<!doctype html>

<head>
    <title>Upload</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='default/icon/favicon.jpg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='uikit-2.25.0/css/uikit.almost-flat.min.css') }}">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/superagent"></script>
    <script src="{{url_for('static', filename='default/js/utils.js')}}"></script>
    <script>

    </script>
</head>

<body style="padding:16px">
    <input id="file" type="file" name="file" multiple="multiple" onchange="selecFileChange(this.files)" />
    <button class="uk-button">button</button>
    <div id="img_show" style="text-align: justify;position: relative;">

    </div>
    <script>
        const imgBaseWidth = 230;
        let imgShowDemoWidth = document.getElementById("img_show").offsetWidth;
        let totalShowWidth = document.body.clientWidth;
        let rowNum = Math.floor(imgShowDemoWidth / imgBaseWidth);
        let imgBaseWidthRemainder = imgShowDemoWidth % imgBaseWidth;
        let imgWidth = imgBaseWidth + Math.floor(imgBaseWidthRemainder / rowNum) - 10 - 10;
        let rowDivDom = '';
        for (let i = 0; i < rowNum; i++) {
            rowDivDom += `
                <div id="imgRow-${i}" style="width:${imgWidth + 10}px;display:inline-block;float:left"></div>
            `
        }
        document.getElementById('img_show').innerHTML = rowDivDom
        function selecFileChange(files) {
            console.log(files)

            if (window.FileReader) {
                for (let i in files) {
                    let reader = new FileReader();
                    reader.readAsDataURL(files[i]);
                    reader.onloadend = function (e) {
                        let minImgRowDomHeight = 9999999;
                        let minImgRowDomId = 0;
                        for (let i = 0; i < rowNum; i++) {
                            if (minImgRowDomHeight > document.getElementById("imgRow-" + i).offsetHeight) {
                                minImgRowDomHeight = document.getElementById("imgRow-" + i).offsetHeight;
                                minImgRowDomId = i;
                            }
                        }

                        document.getElementById("imgRow-" + minImgRowDomId).innerHTML += `
                            <div class="uk-thumbnail uk-animation-slide-top" style="margin:0px">
                                <img src="${reader.result}" style="width:${imgWidth}px" alt="">
                                <div class="uk-thumbnail-caption">...</div>
                            </div>`

                        // superagent
                        //     .post('/upload/imgs/')
                        //     .attach(files[0].name, convertBase64UrlToBlob(reader.result))
                        //     .then(res => {
                        //         console.log("成功~")
                        //         console.log(res)
                        //     }, err => {
                        //         console.log("失败~")
                        //         console.error(err)
                        //     })
                    }
                }

            } else {

            }
        }
    </script>
</body>